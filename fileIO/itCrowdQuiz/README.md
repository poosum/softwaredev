### This is really messy code but at least it works